---
title: 實作 電影院訂位介面
author: Phoebe
tags: Javascript
categories: Portfolio
date: 2021-01-17 21:21:25
---
## 學習到的知識點

> HTML

* 下拉選單
* span is inline-block
<!--more-->

> CSS

* -webkit- 私有前綴
* nth-of-type與nth-child 
* rotateX 旋轉技巧
* perspactive 立體感

> Javascript

* ArrowFunction
* e.target.classList.toggle
* NodeList
* addEventListener("change")
* [... str] 展開運算子
* Localstorage
* setItem 跟 getItem
* json.parse

## 簡介

[DEMO](https://hff2.github.io/My-Projects/Seat_Booking/)

製作電影訂位的網頁，透過選取座位的方式，紀錄已幾選的位置與不同電影呈現不同的票價。

![](https://i.imgur.com/Ny89e6A.png)

## HTML

![](https://i.imgur.com/NPtc9F9.png)



### 電影選單
製作出下拉式選單使用`select`，在`option`選項裡加上`value`，之後可以做為讀取不同電影的不同價格。

![](https://i.imgur.com/vu4r4s1.png)


```htmlembedded=
<div class="movie-container">
   <label>Pick a movie:</label>
   <select id="movie">
      <option value="10">Avengers: Endgame ($10)</option>
      <option value="12">TENET ($12)</option>
      <option value="8">Toy Story 4 ($8)</option>
      <option value="9">The Lion King ($9)</option>
   </select>
</div>
```
### 顯示座位狀態清單

座位顯示狀況說明(N/A meaning that the seat is open)

![](https://i.imgur.com/4tbw2Rk.png)


```htmlembedded=
<ul class="showcase">
   <li>
      <div class="seat"></div>
      <small>N/A</small>
   </li>
   <li>
      <div class="seat selected"></div>
      <small>Selected</small>
   </li>
   <li>
      <div class="seat occupied"></div>
      <small>Occupied</small>
   </li>
</ul>
```
### 座位區

利用div做出六排座位區

![](https://i.imgur.com/sBjfg3s.png)


```htmlembedded=
<div class="container">
   <div class="screen"></div>
   <div class="row">
      <div class="seat occupied"></div>
      <div class="seat"></div>
      <div class="seat"></div>
      <div class="seat"></div>
      <div class="seat"></div>
      <div class="seat"></div>
      <div class="seat"></div>
      <div class="seat"></div>
   </div>
</div>
```

### 顯示已選取幾個座位與價格

span是屬於inline-block，所以可以在同一行對數字進行動態調整。

![](https://i.imgur.com/EOPPNBK.png)




```htmlembedded=
<p class="text">
   You have selected <span id="count">0 </span> seats for a price of $<span id="total">0</span>
</p>
```




## CSS

[Javascript](#Javascript)

### 引入字體
```css=
@import url("https://fonts.googleapis.com/css2?family=Lato&display=swap");
```

### 將整體元素置中

利用`flex`屬性使元素置中畫面中央，先使元素`column`(垂直)排列，再使用`flex-direction: column`與`align-items:center`，主軸副軸置中，視窗高度為`100vh`。

```css=
* {
  box-sizing: border-box;
}

body {
  background-color: #242333;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  font-family: "Lato", sans-serif;
  margin: 0;
}

.movie-container {
  margin: 20px 0;
}
```
### 調整下拉式選單的選項


`-webkit-appearance`，使用系統預設的外觀。

`-webkit-appearance: none`，去除瀏覽器的預設樣式。


webkit是一種瀏覽器的私有前綴，是瀏覽器對新css實現的一個提前支持。
-webkit是指webkit內核的瀏覽器(Safari和Google)，moz是Firefox內核的瀏覽器。。


> 為什麼會出現webkit跟moz這種私有前綴?


因為制定HTML和CSS標準的組織W3C動作較慢，通常，W3C組織成員提出新屬性，比如說`border-radius`，但要審核一個屬性通過需要很多審查，瀏覽器商不想等這麼久，就會在瀏覽器中先加入支持。

但是，避免W3C公布標準時有變更，就會加入一個私有前綴，比如-webkit-border-radius，通過這種方式來提前支持屬性。




```css=
.movie-container select {
  background-color: #fff;
  border: 0;
  border-radius: 5px;
  font-size: 14px;
  margin-left: 10px;
  padding: 5px 15px 5px 15px;
  -moz-appearance: none;
  -webkit-appearance: none;
  appearance: none;
}
```

### 調整座位元素與位置

在每一組seat元素的父元素須加上.row屬性，才能夠每一排都套用到flex屬性。

```css=
.seat {
  background-color: #444451;
  height: 12px;
  width: 15px;
  margin: 3px;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
}

.row {
  display: flex;
}
```

不同狀況(Selected，Occupied)，給予不同顏色。

```css=
.seat.selected {
  background-color: #6feaf6;
}

.seat.occupied {
  background-color: #fff;
}

```
#### 將座位與其他座位空出距離

> nth-of-type 與 nth-child() 有什麼不同?

當選取的元素中間有混雜其他元素，像是`<hr>`，在nth-child會將其他元素一起做計算，但nth-of-type只會計算選取的元素，例如選擇`<p>`，就只會選`<p>`。

```css=
.seat:nth-of-type(2) {
  margin-right: 18px;
}

.seat:nth-last-of-type(2) {
  margin-left: 18px;
}
```

### 滑鼠移動到座位的動畫

不是`.occupied`的就放大1.2倍。

`.showcase`裡的三個說明位置。scale不需要變大，使用default的1倍就好。cursor也是使用default。

```css=
.seat:not(.occupied):hover {
  cursor: pointer;
  transform: scale(1.2);
}

.showcase .seat:not(.occupied):hover {
  cursor: default;
  transform: scale(1);
}
```

### showcase的排列

使用flex屬性自動水平排列，使用`justify-content:space-between`，空間都留在物件之間。


(space-evenly，平均分配空間。space-around，開頭留一份空間，物件留兩份。)

![](https://i.imgur.com/fLtV0NC.png)


```css=
.showcase {
  background-color: rgba(0, 0, 0, 0.1);
  padding: 5px 10px;
  border-radius: 5px;
  color: #777;
  list-style-type: none;
  display: flex;
  justify-content: space-between;
}

.showcase li {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 10px;
}

.showcase li small {
  margin-left: 2px;
}
```
### 電影螢幕

[rotateX MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/rotateX())

選轉技巧

```css=
.screen {
  background-color: #fff;
  height: 70px;
  width: 100%;
  margin: 15px 0;
  transform: rotateX(-45deg);
  box-shadow: 0 3px 10px rgba(255, 255, 255, 0.7);
}
```

[perspactive MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/perspective)

perspactive立體感，數值越高越立體。

```css=
.container {
  perspective: 1000px;
  margin-bottom: 30px;
}
```

### 計算點選幾個座位與價格
```css=
p.text {
  margin: 5px 0;
}

p.text span {
  color: #6feaf6;
}

```



## Javascript

### 讀取Container (Screen & Seats)的元素

1. 宣告變數，如果是之後會用到的值，不能使用const。

2. ticketPrice不能用`const`宣告，因為value會改變，改用`let`。

3. `parseInt`為轉換型別，字串到數字，也可以使用`+`。


4. 使用ES6語法ArrowFunctoin改寫

```javascript=
container.addEventListener("click", function(e) {})
//改成
container.addEventListener("click", (e) => {});
```

5. `container.addEventListener`，點擊後，可以讀取到`.Container`裡面的元素。

```javascript=
const container = document.querySelector(".container");
const seats = document.querySelectorAll(".row .seat:not(.occupied)");
const count = document.getElementById("count");
const total = document.getElementById("total");
const movieSelect = document.getElementById("movie");

let ticketPrice = parseInt(movieSelect.value);

container.addEventListener("click", (e) => {
  console.log(e.target);
});

```

### 當空位被點擊時，會轉換成被選取的顏色

1. 當選取到空位且不是`.occupied`時，加上`.selected`的class樣式。

2. ` e.target.classList.toggle`，可以打開或是關閉(像是電燈開關)，處理`.selected`是否加上去。

3. [classList.其他方法](https://www.javascripttutorial.net/javascript-dom/javascript-classlist/)，包括add，remove。

```javascript=
const ticketPrice = parseInt(movieSelect.value);

container.addEventListener("click", (e) => {
  console.log(e.target);
  if (
    e.target.classList.contains("seat") && !e.target.classList.contains("occupied")
  ) {
    e.target.classList.toggle("selected");
  }
});
```

### 加入Function之後，動態調整座位數與價錢。

> NodeList是什麼?

NodeList 會經由 querySelectorAll()，childNodes 產生，是陣列的一種，無法使用陣列型別的method，但可以索引存取內容。

```javascript=
//點選座位後，讀取到NodeList[]
const selectedSeats = document.querySelectorAll(".row .seat.selected");
//轉換成1,2,3,4
const selectedSeatsCount = selectedSeats.length;
//將讀取到的座位數量放到count變數裡
count.innerText = selectedSeatsCount;
```

完整Function

```javascript=
//更新座位數與價格
function updateSelectedCount() {
  const selectedSeats = document.querySelectorAll(".row .seat.selected");
  const selectedSeatsCount = selectedSeats.length;
  count.innerText = selectedSeatsCount; 
  total.innerText = selectedSeatsCount * ticketPrice;
}

container.addEventListener("click", (e) => {
  if (
    e.target.classList.contains("seat") && !e.target.classList.contains("occupied")
  ) {
    e.target.classList.toggle("selected");
    //增加這個Function
    updateSelectedCount();
  }
});
```
### 更換電影時，可以更換價格

[重新認識 JavaScript: Day 16 那些你知道與不知道的事件們](https://ithelp.ithome.com.tw/articles/10192175)

change是屬於表單事件中的change事件，點擊項目後才觸發。

```javascript=
function updateSelectedCount() {
  const selectedSeats = document.querySelectorAll(".row .seat.selected");
  const selectedSeatsCount = selectedSeats.length;
  count.innerText = selectedSeatsCount;
  total.innerText = selectedSeatsCount * ticketPrice;
}

//增加更換電影的事件
movieSelect.addEventListener("change", (e) => {
  //確保他轉換成number而不是字串
  ticketPrice = parseInt(e.target.value);
  updateSelectedCount();
});

```


### 儲存被點選的座位位置

> [...] 展開運算子。


在 ES6 中，新增了一個 "..." 的關鍵字，這個關鍵字在不同時間點有不同的效果，有些時候它會被當作展開運算子(spread operator使用，有時候則是被當作其餘運算子（rest operator）使用。


展開運算子，是把許多的參數轉換成一個陣列，而展開運算子則是可以把陣列中的元素取出。

```javascript=
const arr1 = [1,2,3]
const arr2 = [...arr1,4,5]
console.log(arr2)
//> Array [1, 2, 3, 4, 5]


const arr1 = [1,2,3]
const arr2 = [...arr1,4,5]
const arr3 = arr2.map(function(item){
	return item*2;
})
console.log(arr3)
//> Array [2, 4, 6, 8, 10]
```

[Spread syntax MDN](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Spread_syntax)
```javascript=
function updateSelectedCount() {
  const selectedSeats = document.querySelectorAll(".row .seat.selected");

  //將藍色座位選取後出現的nodeList轉換成array (Copy seleted seats into array)
  //使用map方法印出array (Map through array)
  //並且使用indexOf方法回傳seat的索引(return a new array indexes)
  const seatsIndex = [...selectedSeats].map((seat) => {
    return [...seats].indexOf(seat);
  });
  
  //可以取得座位的位置 ex:[0,1,7,32]
  console.log(seatsIndex);

  // How many seats you clicked
  const selectedSeatsCount = selectedSeats.length;
  count.innerText = selectedSeatsCount;
```
### 加入LocalStorage

可以在Application裡面查看儲存的座位陣列。

Js 的`setItem`語法，可以將資料寫進瀏覽器裡。`setItem` 的第一個值是key的屬性名，第二個值就是相對應的value。
```javascript=
//加在updateSelectedCount Function裡
localStorage.setItem("selectedSeats", JSON.stringify(seatsIndex));
```

可以在Application裡面查看，儲存的selectedMovieIndex，selectedMoviePrice陣列。

```javascript=
//Save selected movie index and price
function setMovieData(movieIndex, moviePrice) {
  localStorage.setItem("selectedMovieIndex", movieIndex);
  localStorage.setItem("selectedMoviePrice", moviePrice);
}
```

### 從Localhost 取資料，使得點選過後的位置可以填充UI

1. 回傳-1為，陣列內沒有這個元素時會回傳索引值。

```javascript=
const arr2 = [1,2,3,4,5]
console.log(arr2.indexOf(100))
//> -1
```

2. `Json.parse`將字串轉換成陣列或物件的用法。

3. 把資料存進瀏覽器後，要取出來的話要用`getItem`語法


```javascript=
//Get data from localstorage and populate UI
function populateUI() {
  //使用getItem取得要使用的key，為上方設定的'selectedSeats'，並指派變數selectedSeats。
  //使用parse把JSON資料轉換成array
  const selectedSeats = JSON.parse(localStorage.getItem("selectedSeats"));
  //判斷讓藍色座椅是否繼續留著
  //要使用localstorage裡面儲存的資料判斷是否符合。
  if (selectedSeats ! null && selectedSeats.length > 0) {
   //將所有座位使用forEach一個個印出
   //並且判斷每個座位的index號碼是否跟selectedSeats的一樣
   //如果相同則執行加上.selected
    seats.forEach((seat, index) => {
    // -1 就是 udefined
      if (selectedSeats.indexOf(index) > -1) {
        seat.classList.add("selected");
      }
    });
  }
 
  //判斷selectedMovieIndex是否為空
  //不為空則賦值給selectedMovieIndex下拉式選單選取的電影index
  const selectedMovieIndex = localStorage.getItem("selectedMovieIndex");
  if (selectedMovieIndex ! null) {
    movieSelect.selectedIndex = selectedMovieIndex;
  }
}

```

最後在整個JS最下方呼叫一次updateSelectedCount() 函式，這樣重整網頁時，不需經過事件觸發，直接更新下方文字敘述。

## 參考文章

### CSS
[webkit-appearance:none](https://blog.csdn.net/weixin_42220533/article/details/82348509)

[appearance](https://www.oxxostudio.tw/articles/201503/html5-input-range-style.html)

[CSS3選擇器「:nth-child()」與「:nth-of-type()」用法大不同](https://www.minwt.com/webdesign-dev/css/10885.html)

### JS

[NodeList 與 Array 差異](https://ithelp.ithome.com.tw/articles/10211876)

[重新認識 JavaScript: Day 16 那些你知道與不知道的事件們](https://ithelp.ithome.com.tw/articles/10192175)

[【ES6 小筆記】Array.map() - 處理陣列最佳選擇](https://ithelp.ithome.com.tw/articles/10215281)

[Spread syntax MDN](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Spread_syntax)

[JSON.parse 函式 ](https://kingweblife.blogspot.com/2016/03/jsonparse.html)

[JavaScript ES6 中的展開運算子（spread operator）和其餘運算子（rest operator）](https://pjchender.blogspot.com/2017/01/es6-spread-operatorrest-operator.html)